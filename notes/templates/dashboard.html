{% extends "home.html" %}
{% load static tz %}
{% block mainClass %}class="px-4 md:px-0"{% endblock mainClass %}
{% block content %}
    <section class="space-y-6 mt-20 max-w-7xl mx-auto {% if count <= 9 %}h-lvh{% endif %}">
        <!-- Header -->
        <div class="flex items-center space-x-2">
            <div class="relative w-24 h-24">
                <img src="{% if user.profile.image %}{{ user.profile.image.url }}{% else %}{% static 'image/profile.jpg' %}{% endif %}" alt="Profile Image" alt="Profile"
                    class="w-full h-full rounded-full object-cover object-center border-2 border-gray-300">
                <button
                    class="absolute bottom-0 right-0 bg-blue-500 text-white p-1 rounded-full border border-white hover:bg-blue-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15.232 5.232l3.536 3.536M16.5 3a2.121 2.121 0 013 3L7 18H4v-3L16.5 3z" />
                    </svg>
                </button>
            </div>
            <div class="flex flex-col justify-center mt-3 ">
                <h1 class="text-3xl font-bold text-emerald-400">NoteMate</h1>
                {% if user.is_authenticated %}
                <span class="text-blue-600 font-bold text-xl">{% if user.first_name %}{{user.first_name }}{% else %}Mr.***{% endif %}</span>
                <span class='text-small font-semibold text-green-400'>@{{user.username}}</span>
                {% endif %}
            </div>
        </div>

        <!-- Search + Add Note -->
        <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4 md:gap-0 mt-4">
            <!-- Search -->
            <form method="GET" action="{% url 'notes:notes' %}" class="flex gap-2 w-full md:w-1/2">
                <input type="text"  name='search'{% if search %}value="{{search}}"{% endif %} 
                    class="flex-1 border-2 border-blue-500 rounded-md p-2 text-blue-700 bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-400"
                    placeholder="Search Notes" />
                <button type='submit'
                    class="px-4 py-2 rounded-md bg-teal-500 text-white font-semibold hover:bg-teal-600">Search</button>
            </form>

            <!-- Add Note Button -->
            <button id="addNoteBtn"
                class="flex items-center justify-center gap-1 px-4 py-2 rounded-md bg-blue-300 text-white font-semibold hover:bg-blue-400 w-full md:w-40">
                <span class="text-xl font-bold">+</span> Add Note
            </button>
        </div>

        <!-- Notes Grid -->
        <div id="notesContainer" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 mt-6">
            {% for note in nt %}
            <div class="bg-white rounded-xl shadow-md p-5 flex flex-col justify-between hover:shadow-lg transition duration-200">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">{{ note.title }}</h3>
                <p class="text-gray-600 text-sm mb-4">{{ note.note }}</p>
                <div class='flex justify-between'>
                <div class="flex flex-col gap-1 text-gray-500 text-xs relative top-4">
                    <div>Created: {{ note.created_at|date:"M d, Y, h:i A" }}</div>
                    <div>Updated: {{ note.update_at|date:"M d, Y, h:i A" }}</div>
                </div>
                <div class="flex justify-end gap-2 mt-4">
                    <a href="{% url 'notes:edit' note.id %}"
                        class="px-3 py-1 bg-blue-200 rounded-md hover:bg-blue-300 text-sm">Edit</a>
                    <a href='{% url "notes:delete" note.id %}' class="px-3 py-1 bg-red-200 rounded-md hover:bg-red-300 text-sm">Delete</a>
                </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Add/Edit Note Modal -->
        <div id="noteFormWrapper"
            class="fixed inset-0 hidden bg-black/40  flex items-center justify-center z-50">
            <div class="bg-white rounded-xl shadow-lg p-6 space-y-4 max-w-md w-11/12 relative animate-scaleIn">
                <button id="closeBtn"
                    class="absolute top-4 right-3 text-gray-500 hover:text-gray-800 text-xl font-bold p-1 w-8 h-8 hover:bg-slate-300 border-2 rounded-sm shadow-md shadow-gray-200">
                    <img src='{% static "image/square-x.svg" %}' class="w-8 h-8 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"
                        alt="Close" />
                </button>
                <h2 class="text-2xl font-semibold text-gray-700">Add New Note</h2>
                <form id="noteForm" method="POST" class="space-y-4">
                    {% csrf_token %}
                    <input type="text" name="title" placeholder="Title"
                        class="w-full border-2 border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-400" />
                    <textarea name="description" placeholder="Description" rows="4"
                        class="w-full border-2 border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-400"></textarea>
                    <div class="flex justify-end">
                        <button type="submit"
                            class="px-4 py-2 bg-blue-400 text-white rounded-md hover:bg-blue-500 transition">Save</button>
                    </div>
                </form>
            </div>
        </div>

        {% block edit_modal %}{% endblock edit_modal %}
    </section>
{% endblock content %}
